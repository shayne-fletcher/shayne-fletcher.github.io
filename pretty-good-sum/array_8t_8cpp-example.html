<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.10"/>
<title>Pretty Good Sum Type: array.t.cpp</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Pretty Good Sum Type
   &#160;<span id="projectnumber">1.0.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.10 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">array.t.cpp</div>  </div>
</div><!--header-->
<div class="contents">
<p>An implementation of persistent arrays</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;gtest/gtest.h&gt;</span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#include &quot;sum_type.hpp&quot;</span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#include &lt;memory&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;vector&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;iterator&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;algorithm&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;iostream&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;sstream&gt;</span></div>
<div class="line"></div>
<div class="line"><span class="comment">//A persistent array is a data structure providing the same operations</span></div>
<div class="line"><span class="comment">//as a usual array, namely the manipulation of elements indexed from</span></div>
<div class="line"><span class="comment">//`0` to `n - 1`, with low cost access and update operations, but</span></div>
<div class="line"><span class="comment">//where the update operation returns a new persistent array and leaves</span></div>
<div class="line"><span class="comment">//the previous one unchanged.</span></div>
<div class="line"></div>
<div class="line"><span class="comment">//The approach taken here due to Baker[1] follows the recitation in</span></div>
<div class="line"><span class="comment">//Conchon/Filliatre[2]. For the sake of this being tutorial in nature,</span></div>
<div class="line"><span class="comment">//we stop short of providing the version that employs &quot;rerooting&quot; (not</span></div>
<div class="line"><span class="comment">//that it&#39;s at all hard to implement).</span></div>
<div class="line"></div>
<div class="line"><span class="comment">//What&#39;s interesting about this data structure is that from the point</span></div>
<div class="line"><span class="comment">//of view of the client, it is purely applicative. However, the</span></div>
<div class="line"><span class="comment">//implementation is imperative in nature and the persistence illusory!</span></div>
<div class="line"></div>
<div class="line"><span class="comment">//One thing to watch out for here is the massive use of side effects</span></div>
<div class="line"><span class="comment">//rendering this program seriously multi-thread unfriendly.</span></div>
<div class="line"></div>
<div class="line"><span class="comment">//[1] Henry G. Baker. Shallow binding in Lisp 1.5. Commun. ACM,</span></div>
<div class="line"><span class="comment">//21(7):565-569, 1978.</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">//[2]&quot;A Persistent Union-Find Data Structure Sylvain Conchon,</span></div>
<div class="line"><span class="comment">//Jean-Chrisophe Filliatre</span></div>
<div class="line"><span class="comment">//&quot;http://www.lri.fr/~filliatr/ftp/publis/puf-wml07.ps</span></div>
<div class="line"></div>
<div class="line"><span class="keyword">namespace </span>{</div>
<div class="line"></div>
<div class="line">  <span class="keyword">namespace </span>detail {</div>
<div class="line"></div>
<div class="line">  <span class="keyword">using namespace </span><a class="code" href="namespacepgs.html">pgs</a>;</div>
<div class="line"></div>
<div class="line">  <span class="comment">//The goal here is an efficient solution to the problem of</span></div>
<div class="line">  <span class="comment">//persistent arrays. The basic idea is to use a usual array for</span></div>
<div class="line">  <span class="comment">//the last version of the persistent array and indirections for</span></div>
<div class="line">  <span class="comment">//pervious versions.</span></div>
<div class="line"></div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keyword">class</span> T&gt; <span class="keyword">struct </span>array_data; <span class="comment">//fwd. decl.</span></div>
<div class="line"></div>
<div class="line">  <span class="comment">//`peristent_array&lt;T&gt;` is the type of persistent arrays. It is a</span></div>
<div class="line">  <span class="comment">//reference on a value of type `array_data&lt;T&gt;` which inidicates</span></div>
<div class="line">  <span class="comment">//its nature (being a sum of two cases)</span></div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keyword">class</span> T&gt; <span class="keyword">using</span> persistent_array = <a name="_a0"></a><a class="codeRef" doxygen="D:/project/pretty-good-sum.git/doxygen/cppreference-doxygen-web.tag.xml:http://en.cppreference.com/w/" href="http://en.cppreference.com/w/cpp/memory/shared_ptr.html">std::shared_ptr&lt;array_data&lt;T&gt;</a>&gt;;</div>
<div class="line"></div>
<div class="line">  <span class="comment">//Case 1 : An immediate value of type `array_t&lt;T&gt;` containing a</span></div>
<div class="line">  <span class="comment">//member `data` of type `std::vector&lt;T&gt;`</span></div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keyword">class</span> T&gt;</div>
<div class="line">  <span class="keyword">struct </span>array_t {</div>
<div class="line">    <a name="_a1"></a><a class="codeRef" doxygen="D:/project/pretty-good-sum.git/doxygen/cppreference-doxygen-web.tag.xml:http://en.cppreference.com/w/" href="http://en.cppreference.com/w/cpp/container/vector.html">std::vector &lt;T&gt;</a> data;<span class="comment">//array data</span></div>
<div class="line">    array_t (<a name="_a2"></a><a class="codeRef" doxygen="D:/project/pretty-good-sum.git/doxygen/cppreference-doxygen-web.tag.xml:http://en.cppreference.com/w/" href="http://en.cppreference.com/w/cpp/types/size_t.html">std::size_t</a> n, T <span class="keyword">const</span>&amp; val) : data (n, val)</div>
<div class="line">    {}</div>
<div class="line">    array_t (<a class="codeRef" doxygen="D:/project/pretty-good-sum.git/doxygen/cppreference-doxygen-web.tag.xml:http://en.cppreference.com/w/" href="http://en.cppreference.com/w/cpp/container/vector.html">std::vector&lt;T&gt;</a>&amp;&amp; data) : data (data)</div>
<div class="line">    {}</div>
<div class="line">  };</div>
<div class="line"></div>
<div class="line">  <span class="comment">//Case 2 : An indirection of type `diff_t&lt;T&gt;` value effectively a</span></div>
<div class="line">  <span class="comment">//product `(i, v, t)` standing for a persistent array which is</span></div>
<div class="line">  <span class="comment">//identical to the persistent array `t` everywhere except at index</span></div>
<div class="line">  <span class="comment">//`i` where it contains `v`</span></div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keyword">class</span> T&gt;</div>
<div class="line">  <span class="keyword">struct </span>diff_t {</div>
<div class="line">    <a class="codeRef" doxygen="D:/project/pretty-good-sum.git/doxygen/cppreference-doxygen-web.tag.xml:http://en.cppreference.com/w/" href="http://en.cppreference.com/w/cpp/types/size_t.html">std::size_t</a> i; <span class="comment">//index</span></div>
<div class="line">    T v;  <span class="comment">//value at that index</span></div>
<div class="line">    persistent_array&lt;T&gt; t;  <span class="comment">//the base array</span></div>
<div class="line">    diff_t (<a class="codeRef" doxygen="D:/project/pretty-good-sum.git/doxygen/cppreference-doxygen-web.tag.xml:http://en.cppreference.com/w/" href="http://en.cppreference.com/w/cpp/types/size_t.html">std::size_t</a> i, T <span class="keyword">const</span>&amp; v, persistent_array&lt;T&gt; <span class="keyword">const</span>&amp; t) </div>
<div class="line">      : i (i), v(v), t (t) </div>
<div class="line">    {}</div>
<div class="line">  };</div>
<div class="line"></div>
<div class="line">  <span class="comment">//The definition of the sum `array_data&lt;T&gt;` is achieved via</span></div>
<div class="line">  <span class="comment">//inheritance and a forwarding construtor</span></div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keyword">class</span> T&gt;</div>
<div class="line">  <span class="keyword">struct </span>array_data : <a name="_a3"></a><a class="code" href="classpgs_1_1sum__type.html">sum_type</a>&lt;array_t&lt;T&gt;, diff_t&lt;T&gt;&gt; {</div>
<div class="line">    <span class="keyword">using</span> base_type = <a class="code" href="classpgs_1_1sum__type.html">sum_type&lt;array_t&lt;T&gt;</a>, diff_t&lt;T&gt;&gt;;</div>
<div class="line">    <span class="keyword">template</span> &lt;<span class="keyword">class </span>U, <span class="keyword">class</span>... Args&gt;</div>
<div class="line">      array_data (<a name="_a4"></a><a class="code" href="structpgs_1_1constructor.html">constructor&lt;U&gt;</a> t, Args&amp;&amp;... args)</div>
<div class="line">      : base_type (t, std::forward&lt;Args&gt;(args)...)</div>
<div class="line">    {}</div>
<div class="line">  };</div>
<div class="line"></div>
<div class="line">  <span class="comment">//`make (n, val)` returns a persistent array containing `n` copies</span></div>
<div class="line">  <span class="comment">//of `val`</span></div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keyword">class</span> T&gt;</div>
<div class="line">  persistent_array&lt;T&gt; make (<a class="codeRef" doxygen="D:/project/pretty-good-sum.git/doxygen/cppreference-doxygen-web.tag.xml:http://en.cppreference.com/w/" href="http://en.cppreference.com/w/cpp/types/size_t.html">std::size_t</a> n, T <span class="keyword">const</span>&amp; val) {</div>
<div class="line">    <span class="keywordflow">return</span> persistent_array&lt;T&gt;{</div>
<div class="line">      <span class="keyword">new</span> array_data&lt;T&gt;{<a class="code" href="structpgs_1_1constructor.html">constructor&lt;array_t&lt;T&gt;</a>&gt;{}, n, val}};</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  <span class="comment">//To implement `get` we consider the two cases. Either the</span></div>
<div class="line">  <span class="comment">//persistent array is an immediate array, or we need to consider</span></div>
<div class="line">  <span class="comment">//the indirection and possibly recursively access another</span></div>
<div class="line">  <span class="comment">//persistent array</span></div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keyword">class</span> T&gt;</div>
<div class="line">  T <span class="keyword">const</span>&amp; <span class="keyword">get</span> (persistent_array&lt;T&gt; <span class="keyword">const</span>&amp; t, <a class="codeRef" doxygen="D:/project/pretty-good-sum.git/doxygen/cppreference-doxygen-web.tag.xml:http://en.cppreference.com/w/" href="http://en.cppreference.com/w/cpp/types/size_t.html">std::size_t</a> i) {</div>
<div class="line">    <span class="keywordflow">return</span> t-&gt;match&lt;T <span class="keyword">const</span>&amp;&gt;(</div>
<div class="line">      [=](array_t&lt;T&gt; <span class="keyword">const</span>&amp; a) -&gt; T <span class="keyword">const</span>&amp; { </div>
<div class="line">        <span class="keywordflow">return</span> a.data[i]; </div>
<div class="line">      }</div>
<div class="line">    , [=](diff_t&lt;T&gt; <span class="keyword">const</span>&amp; d)  -&gt; T <span class="keyword">const</span>&amp; { </div>
<div class="line">        <span class="keywordflow">return</span> (i == d.i) ? d.v : <span class="keyword">get</span> (d.t, i); });</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  <span class="comment">//`set` is where the subtlety is concentrated. The idea is to keep</span></div>
<div class="line">  <span class="comment">//the efficiency of a usual array on the very last version of the</span></div>
<div class="line">  <span class="comment">//persistent array, while possibly decreasing the efficiency of</span></div>
<div class="line">  <span class="comment">//previous versions</span></div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keyword">class</span> T&gt;</div>
<div class="line">  persistent_array&lt;T&gt; set (</div>
<div class="line">      persistent_array&lt;T&gt; <span class="keyword">const</span>&amp; t<span class="comment">//preserve conceptual &#39;constness&#39;</span></div>
<div class="line">    , <a class="codeRef" doxygen="D:/project/pretty-good-sum.git/doxygen/cppreference-doxygen-web.tag.xml:http://en.cppreference.com/w/" href="http://en.cppreference.com/w/cpp/types/size_t.html">std::size_t</a> i, T <span class="keyword">const</span>&amp; v) {</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span> t-&gt;match&lt;persistent_array&lt;T&gt;&gt;(</div>
<div class="line">      [&amp;t, &amp;v, i](array_t&lt;T&gt;&amp; a) -&gt; persistent_array&lt;T&gt; {</div>
<div class="line">        T old = a.data[i];</div>
<div class="line">        a.data[i] = v;</div>
<div class="line">        <span class="comment">//`res` will be the newest version</span></div>
<div class="line">        persistent_array&lt;T&gt; res{</div>
<div class="line">          <span class="keyword">new</span> array_data&lt;T&gt;{<a class="code" href="structpgs_1_1constructor.html">constructor&lt;array_t&lt;T&gt;</a>&gt;{}, <a name="a5"></a><a class="codeRef" doxygen="D:/project/pretty-good-sum.git/doxygen/cppreference-doxygen-web.tag.xml:http://en.cppreference.com/w/" href="http://en.cppreference.com/w/cpp/utility/move.html">std::move</a> (a.data)}};</div>
<div class="line">        <span class="comment">//Now, replace the contents of `t` with an indirection</span></div>
<div class="line">        *(<span class="keyword">const_cast&lt;</span>persistent_array&lt;T&gt;&amp;<span class="keyword">&gt;</span>(t)) = array_data&lt;T&gt;{<a class="code" href="structpgs_1_1constructor.html">constructor&lt;diff_t&lt;T&gt;</a>&gt;{}, i, old, res};</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">return</span> res;</div>
<div class="line">      }</div>
<div class="line"></div>
<div class="line">    , [t, v, i](diff_t&lt;T&gt;&amp; d) -&gt; persistent_array&lt;T&gt; {</div>
<div class="line">        <span class="keywordflow">return</span> persistent_array&lt;T&gt;{</div>
<div class="line">          <span class="keyword">new</span> array_data&lt;T&gt;{<a class="code" href="structpgs_1_1constructor.html">constructor&lt;diff_t&lt;T&gt;</a>&gt;{}, i, v, t}};</div>
<div class="line">      });</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  <span class="comment">//`ostream` inserter for persistent arrays</span></div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keyword">class</span> T&gt;</div>
<div class="line">  <a name="_a6"></a><a class="codeRef" doxygen="D:/project/pretty-good-sum.git/doxygen/cppreference-doxygen-web.tag.xml:http://en.cppreference.com/w/" href="http://en.cppreference.com/w/cpp/io/basic_ostream.html">std::ostream</a>&amp; operator &lt;&lt; (</div>
<div class="line">     <a class="codeRef" doxygen="D:/project/pretty-good-sum.git/doxygen/cppreference-doxygen-web.tag.xml:http://en.cppreference.com/w/" href="http://en.cppreference.com/w/cpp/io/basic_ostream.html">std::ostream</a>&amp; os, persistent_array&lt;T&gt; <span class="keyword">const</span>&amp; t) {</div>
<div class="line">    <span class="keywordflow">return</span> t-&gt;match&lt;<a class="codeRef" doxygen="D:/project/pretty-good-sum.git/doxygen/cppreference-doxygen-web.tag.xml:http://en.cppreference.com/w/" href="http://en.cppreference.com/w/cpp/io/basic_ostream.html">std::ostream</a>&amp;&gt;(</div>
<div class="line">      [&amp;](array_t&lt;T&gt; <span class="keyword">const</span>&amp; a) -&gt; <a class="codeRef" doxygen="D:/project/pretty-good-sum.git/doxygen/cppreference-doxygen-web.tag.xml:http://en.cppreference.com/w/" href="http://en.cppreference.com/w/cpp/io/basic_ostream.html">std::ostream</a>&amp; {</div>
<div class="line">        os &lt;&lt; <span class="stringliteral">&quot;[| &quot;</span>;</div>
<div class="line">        <a name="a7"></a><a class="codeRef" doxygen="D:/project/pretty-good-sum.git/doxygen/cppreference-doxygen-web.tag.xml:http://en.cppreference.com/w/" href="http://en.cppreference.com/w/cpp/algorithm/copy.html">std::copy</a> (a.data.begin (), a.data.end ()</div>
<div class="line">                   , <a name="_a8"></a><a class="codeRef" doxygen="D:/project/pretty-good-sum.git/doxygen/cppreference-doxygen-web.tag.xml:http://en.cppreference.com/w/" href="http://en.cppreference.com/w/cpp/iterator/ostream_iterator.html">std::ostream_iterator&lt;T&gt;</a>(os, <span class="stringliteral">&quot;; &quot;</span>));</div>
<div class="line">        os &lt;&lt; <span class="stringliteral">&quot;|]&quot;</span>;</div>
<div class="line">        <span class="keywordflow">return</span> os;</div>
<div class="line">      }</div>
<div class="line">      , [&amp;](diff_t&lt;T&gt; <span class="keyword">const</span>&amp; d) -&gt; <a class="codeRef" doxygen="D:/project/pretty-good-sum.git/doxygen/cppreference-doxygen-web.tag.xml:http://en.cppreference.com/w/" href="http://en.cppreference.com/w/cpp/io/basic_ostream.html">std::ostream</a>&amp; {</div>
<div class="line">        os &lt;&lt; <span class="stringliteral">&quot;Diff (&quot;</span>;</div>
<div class="line">        os &lt;&lt; d.i &lt;&lt; <span class="stringliteral">&quot;, &quot;</span> &lt;&lt; d.v &lt;&lt; <span class="stringliteral">&quot;, &quot;</span> &lt;&lt; d.t;</div>
<div class="line">        os &lt;&lt; <span class="stringliteral">&quot;)&quot;</span>;</div>
<div class="line">        <span class="keywordflow">return</span> os;</div>
<div class="line">      });</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  <span class="comment">//Return a string representation of the given persistent array</span></div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keyword">class</span> T&gt;</div>
<div class="line">  <a name="_a9"></a><a class="codeRef" doxygen="D:/project/pretty-good-sum.git/doxygen/cppreference-doxygen-web.tag.xml:http://en.cppreference.com/w/" href="http://en.cppreference.com/w/cpp/string/basic_string.html">std::string</a> string_of_persistent_array (persistent_array&lt;T&gt; <span class="keyword">const</span>&amp; t) {</div>
<div class="line">    <a name="_a10"></a><a class="codeRef" doxygen="D:/project/pretty-good-sum.git/doxygen/cppreference-doxygen-web.tag.xml:http://en.cppreference.com/w/" href="http://en.cppreference.com/w/cpp/io/basic_ostringstream.html">std::ostringstream</a> os;</div>
<div class="line">    os &lt;&lt; t;</div>
<div class="line">    <span class="keywordflow">return</span> os.<a name="a11"></a><a class="codeRef" doxygen="D:/project/pretty-good-sum.git/doxygen/cppreference-doxygen-web.tag.xml:http://en.cppreference.com/w/" href="http://en.cppreference.com/w/cpp/io/basic_ostringstream/str.html">str</a> ();</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  }<span class="comment">//namespace detail</span></div>
<div class="line"></div>
<div class="line">  <span class="comment">//Wrap this thing up with an object-oriented facade</span></div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keyword">class</span> T&gt;</div>
<div class="line">  <span class="keyword">class </span>persistent_array {</div>
<div class="line">  <span class="keyword">private</span>:</div>
<div class="line">    detail::persistent_array&lt;T&gt; impl_;</div>
<div class="line"></div>
<div class="line">  <span class="keyword">private</span>:</div>
<div class="line">    persistent_array (detail::persistent_array&lt;T&gt; a)</div>
<div class="line">      : impl_(a)</div>
<div class="line">    {}</div>
<div class="line"></div>
<div class="line">  <span class="keyword">public</span>: </div>
<div class="line">    persistent_array (<a class="codeRef" doxygen="D:/project/pretty-good-sum.git/doxygen/cppreference-doxygen-web.tag.xml:http://en.cppreference.com/w/" href="http://en.cppreference.com/w/cpp/types/size_t.html">std::size_t</a> n, T <span class="keyword">const</span>&amp; val)</div>
<div class="line">      : impl_ (detail::make (n, val))</div>
<div class="line">    {}</div>
<div class="line"></div>
<div class="line">    T <span class="keyword">const</span>&amp; <span class="keyword">get</span> (<a class="codeRef" doxygen="D:/project/pretty-good-sum.git/doxygen/cppreference-doxygen-web.tag.xml:http://en.cppreference.com/w/" href="http://en.cppreference.com/w/cpp/types/size_t.html">std::size_t</a> i) <span class="keyword">const</span> {</div>
<div class="line">      <span class="keywordflow">return</span> detail_::get (impl_, i);</div>
<div class="line">    } </div>
<div class="line"></div>
<div class="line">    persistent_array&lt;T&gt; set (<a class="codeRef" doxygen="D:/project/pretty-good-sum.git/doxygen/cppreference-doxygen-web.tag.xml:http://en.cppreference.com/w/" href="http://en.cppreference.com/w/cpp/types/size_t.html">std::size_t</a> i, T <span class="keyword">const</span>&amp; val)<span class="keyword"> const </span>{</div>
<div class="line">      <span class="keywordflow">return</span> persistent_array&lt;T&gt;{detail::set (impl_, i, val)};</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <a class="codeRef" doxygen="D:/project/pretty-good-sum.git/doxygen/cppreference-doxygen-web.tag.xml:http://en.cppreference.com/w/" href="http://en.cppreference.com/w/cpp/string/basic_string.html">std::string</a> as_string ()<span class="keyword"> const </span>{</div>
<div class="line">      <span class="keywordflow">return</span> detail::string_of_persistent_array (impl_);</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">  };</div>
<div class="line"></div>
<div class="line">}<span class="comment">//namespace&lt;anonymous&gt;</span></div>
<div class="line"></div>
<div class="line">TEST (<a class="code" href="namespacepgs.html">pgs</a>, array) {</div>
<div class="line"></div>
<div class="line">  persistent_array&lt;int&gt; a0{7, 0};</div>
<div class="line">  persistent_array&lt;int&gt; a1 = a0.set (1, 7);</div>
<div class="line">  persistent_array&lt;int&gt; a2 = a1.set (2, 8);</div>
<div class="line">  persistent_array&lt;int&gt; a3 = a1.set (2, 9);</div>
<div class="line"></div>
<div class="line">  ASSERT_EQ (</div>
<div class="line">    a0.as_string ()</div>
<div class="line">  , <a class="codeRef" doxygen="D:/project/pretty-good-sum.git/doxygen/cppreference-doxygen-web.tag.xml:http://en.cppreference.com/w/" href="http://en.cppreference.com/w/cpp/string/basic_string.html">std::string</a> (<span class="stringliteral">&quot;Diff (1, 0, Diff (2, 0, [| 0; 7; 8; 0; 0; 0; 0; |]))&quot;</span>));</div>
<div class="line">  ASSERT_EQ (</div>
<div class="line">    a1.as_string ()</div>
<div class="line">  , <a class="codeRef" doxygen="D:/project/pretty-good-sum.git/doxygen/cppreference-doxygen-web.tag.xml:http://en.cppreference.com/w/" href="http://en.cppreference.com/w/cpp/string/basic_string.html">std::string</a> (<span class="stringliteral">&quot;Diff (2, 0, [| 0; 7; 8; 0; 0; 0; 0; |])&quot;</span>));</div>
<div class="line">  ASSERT_EQ (</div>
<div class="line">    a2.as_string ()</div>
<div class="line">  , <a class="codeRef" doxygen="D:/project/pretty-good-sum.git/doxygen/cppreference-doxygen-web.tag.xml:http://en.cppreference.com/w/" href="http://en.cppreference.com/w/cpp/string/basic_string.html">std::string</a> (<span class="stringliteral">&quot;[| 0; 7; 8; 0; 0; 0; 0; |]&quot;</span>));</div>
<div class="line">  ASSERT_EQ (</div>
<div class="line">    a3.as_string ()</div>
<div class="line">  , <a class="codeRef" doxygen="D:/project/pretty-good-sum.git/doxygen/cppreference-doxygen-web.tag.xml:http://en.cppreference.com/w/" href="http://en.cppreference.com/w/cpp/string/basic_string.html">std::string</a> (<span class="stringliteral">&quot;Diff (2, 9, Diff (2, 0, [| 0; 7; 8; 0; 0; 0; 0; |]))&quot;</span>));</div>
<div class="line">}</div>
</div><!-- fragment --> </div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.10
</small></address>
</body>
</html>
